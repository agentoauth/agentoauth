<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgentOAuth Playground</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div>
                    <h1>AgentOAuth Playground</h1>
                    <p class="subtitle">Build policies and test agent authorization tokens</p>
                </div>
                <div class="header-links">
                    <a href="/docs" class="header-link">üìñ Documentation</a>
                    <a href="https://github.com/agentoauth/agentoauth" target="_blank" class="header-link">üì¶ GitHub</a>
                </div>
            </div>
        </header>

        <!-- Global Configuration -->
        <section class="global-config">
            <div class="verifier-info">
                <strong>‚öôÔ∏è Verifier API</strong>
                <div class="verifier-badge">Hosted Verifier</div>
            </div>
            <small class="field-hint">Using AgentOAuth hosted verifier with demo token support</small>
        </section>

        <main>
            <div class="tabs">
                <button class="tab-btn active" data-tab="policy-builder">‚öôÔ∏è Policy Builder</button>
                <button class="tab-btn" data-tab="policy-tester">üß™ Policy Tester</button>
                <button class="tab-btn" data-tab="validator">üîç Token Validator</button>
            </div>

            <!-- Policy Builder Tab -->
            <section class="tab-content active input-section" data-content="policy-builder">
                <h2 class="tab-title">Policy Builder (pol.v0.2)</h2>
                <p class="tab-description">Create structured authorization policies for programmable consent</p>
                
                <div class="template-selector">
                    <label for="policy-template"><strong>üìã Load Template (optional)</strong></label>
                    <select id="policy-template" class="template-dropdown">
                        <option value="">-- Start from scratch --</option>
                        <option value="travel">‚úàÔ∏è Travel Booking ($500/txn, $2000/week, weekdays only)</option>
                        <option value="micropay">üí∏ Micro-payments ($10/txn, $100/day)</option>
                        <option value="enterprise">üè¢ Enterprise Purchase ($5000/txn, specific merchants)</option>
                    </select>
                    <div id="template-description" class="template-description" style="display: none;"></div>
                </div>
                
                <div class="policy-form">
                    <!-- Step 1: Basic Information -->
                    <div class="form-section">
                        <h3 class="form-section-title">Step 1: Basic Information</h3>
                        <div class="form-group">
                            <label for="policy-id"><strong>Policy ID</strong> <span class="label-badge optional">Optional</span></label>
                            <input type="text" id="policy-id" placeholder="pol_01HXZ8K9P4QN2M1R3T5V7W9X" value="">
                        </div>
                    </div>
                    
                    <!-- Step 2: What can the agent do? -->
                    <div class="form-section">
                        <h3 class="form-section-title">Step 2: What can the agent do? ‚úã</h3>
                        <div class="form-group">
                            <label for="policy-actions"><strong>Actions</strong> <span class="label-badge required">Required</span></label>
                            <input type="text" id="policy-actions" placeholder="payments.send,payments.review" value="payments.send">
                            <small class="field-hint">Comma-separated list of allowed actions</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="policy-merchants"><strong>Merchants</strong> <span class="label-badge optional">Optional</span></label>
                            <input type="text" id="policy-merchants" placeholder="airbnb,expedia,booking" value="">
                            <small class="field-hint">Restrict to specific merchants (comma-separated)</small>
                        </div>
                    </div>
                    
                    <!-- Step 3: Spending Limits -->
                    <div class="form-section">
                        <h3 class="form-section-title">Step 3: Spending Limits üí∞</h3>
                        <div class="form-group">
                            <label for="policy-amount"><strong>Per-Transaction Limit</strong> <span class="label-badge required">Required</span></label>
                            <div class="form-row">
                                <div class="form-group" style="margin-bottom: 0;">
                                    <input type="number" id="policy-amount" placeholder="500" value="500">
                                </div>
                                <div class="form-group" style="margin-bottom: 0;">
                                    <input type="text" id="policy-currency" placeholder="USD" value="USD" maxlength="3">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label><strong>Per-Period Budget</strong> <span class="label-badge required">Required</span></label>
                            <div class="form-row">
                                <div class="form-group" style="margin-bottom: 0;">
                                    <input type="number" id="policy-period-amount" placeholder="1500" value="1500">
                                </div>
                                <div class="form-group" style="margin-bottom: 0;">
                                    <select id="policy-period">
                                        <option value="week" selected>Week</option>
                                        <option value="day">Day</option>
                                        <option value="month">Month</option>
                                        <option value="hour">Hour</option>
                                    </select>
                                </div>
                            </div>
                            <small class="field-hint">Maximum total spending over the selected time period</small>
                        </div>
                    </div>
                    
                    <!-- Advanced Options -->
                    <div class="form-section">
                        <button type="button" class="toggle-section-btn" onclick="toggleAdvancedOptions()">
                            <span class="toggle-icon">‚ñº</span> Advanced Options
                        </button>
                        <div id="advanced-options" class="toggle-content" style="display: none;">
                            <h3 class="form-section-title">üïí Time Constraints</h3>
                            <div class="form-group">
                                <label><strong>Time Window</strong> <span class="label-badge optional">Optional</span></label>
                                <small class="field-hint" style="display: block; margin-bottom: 0.5rem;">
                                    Leave empty to allow 24/7. Fill both start and end to restrict to specific hours.
                                </small>
                                <div class="form-row">
                                    <input type="text" id="policy-start" placeholder="08:00" value="">
                                    <span style="align-self: center;">to</span>
                                    <input type="text" id="policy-end" placeholder="20:00" value="">
                                    <input type="text" id="policy-tz" placeholder="America/Los_Angeles" value="">
                                </div>
                                <small class="field-hint">Format: HH:MM (24-hour). Timezone is optional.</small>
                            </div>
                            
                            <h3 class="form-section-title">üîí Security Settings</h3>
                            <div class="form-group">
                                <label><input type="checkbox" id="policy-strict"> <strong>Strict Mode</strong></label>
                                <small class="field-hint">Unknown fields in requests will result in denial</small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button id="build-policy-btn" class="btn-primary">Build Policy JSON</button>
                
                <div id="policy-output" class="output-section" style="display: none; margin-top: 1rem;">
                    <div class="result-header" style="background: #d1ecf1; color: #0c5460;">
                        <strong>Policy JSON</strong>
                        <button onclick="copyPolicyJson()" style="float: right; margin-top: -0.25rem; padding: 0.35rem 0.75rem; background: #0066cc; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9em; font-weight: 600;">
                            üìã Copy Policy JSON
                        </button>
                    </div>
                    <div class="result-body">
                        <pre id="policy-json"></pre>
                    </div>
                    
                    <!-- Token Mode Selector -->
                    <div class="token-mode-selector" style="margin-top: 1.5rem; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                        <strong style="display: block; margin-bottom: 0.75rem;">Next Step: Create Token</strong>
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                <input type="radio" name="token-mode" value="demo" checked>
                                <span>üéì Demo Token (learn the flow)</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                <input type="radio" name="token-mode" value="external">
                                <span>üîß Your Own Token (paste existing)</span>
                            </label>
                        </div>
                        <small class="field-hint" style="margin-top: 0.5rem; display: block;">
                            Demo mode: Server-signed educational tokens ‚Ä¢ External: Verify your SDK-generated tokens
                        </small>
                    </div>
                    
                    <!-- Demo Token Section -->
                    <div id="demo-token-section" style="margin-top: 1rem;">
                        <div class="demo-warning" style="padding: 0.75rem; background: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; margin-bottom: 1rem;">
                            ‚ö†Ô∏è <strong>Demo Mode:</strong> Tokens are signed with a demo issuer key for educational purposes only. Not for production use.
                        </div>
                        <button id="issue-demo-token-btn" class="btn-secondary">Issue Demo Token</button>
                    </div>
                    
                    <!-- External Token Section -->
                    <div id="external-token-section" style="margin-top: 1rem; display: none;">
                        <div class="form-group">
                            <label for="external-token-input"><strong>Paste Your Token</strong></label>
                            <textarea id="external-token-input" rows="4" placeholder="Paste a token generated from your SDK (with iss claim)"></textarea>
                        </div>
                        <button id="verify-external-token-btn" class="btn-secondary">Decode & Verify Token</button>
                    </div>
                </div>
                
                <!-- Demo Token Output -->
                <div id="demo-token-output" class="output-section" style="display: none; margin-top: 1rem;">
                    <div class="result-header" style="background: #d4edda; color: #155724;">
                        <strong>‚úÖ Demo Token Issued</strong>
                        <span class="demo-badge" style="float: right; background: #ffc107; color: #000; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.85em;">DEMO</span>
                    </div>
                    <div class="result-body">
                        <div style="margin-bottom: 1rem;">
                            <strong>Token (JWS Compact):</strong>
                            <button id="copy-demo-token-btn" style="margin-left: 0.5rem; padding: 0.35rem 0.75rem; background: #10b981; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9em; font-weight: 600;">
                                üìã Copy
                            </button>
                            <button id="toggle-full-token-btn" style="margin-left: 0.5rem; padding: 0.35rem 0.75rem; background: #6366f1; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9em; font-weight: 600;">
                                üëÅÔ∏è Show Full
                            </button>
                        </div>
                        <pre id="demo-token-compact" style="background: #f8f9fa; padding: 0.5rem; overflow-x: auto; font-size: 0.85em;"></pre>
                        <pre id="demo-token-full" style="background: #f8f9fa; padding: 0.5rem; overflow-x: auto; font-size: 0.75em; white-space: pre-wrap; word-break: break-all; display: none;"></pre>
                        
                        <div style="margin-top: 1rem;">
                            <strong>Decoded Payload:</strong>
                        </div>
                        <pre id="demo-token-payload" style="background: #f8f9fa; padding: 0.5rem; font-size: 0.9em;"></pre>
                        
                        <div style="margin-top: 1rem;">
                            <strong>Token Metadata:</strong>
                        </div>
                        <div style="background: #f8f9fa; padding: 0.75rem; border-radius: 4px; font-size: 0.9em;">
                            <div><strong>Issuer:</strong> <code id="demo-token-issuer"></code></div>
                            <div><strong>Key ID:</strong> <code id="demo-token-kid"></code></div>
                            <div><strong>Policy Hash:</strong> <code id="demo-token-hash"></code></div>
                            <div><strong>Expires:</strong> <span id="demo-token-expires"></span></div>
                        </div>
                        
                        <div style="margin-top: 1rem; padding: 1rem; background: #e7f3ff; border-left: 4px solid #0066cc; border-radius: 4px;">
                            <strong>üí° Ready to test?</strong> Verify this token with policy evaluation:
                            <button id="verify-demo-token-btn" class="btn-secondary" style="margin-left: 1rem;">
                                Verify This Token ‚Üí
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Policy Tester Tab -->
            <section class="tab-content input-section" data-content="policy-tester">
                <h2 class="tab-title">Policy Tester</h2>
                <p class="tab-description">Test policy evaluation with token + request context</p>
                
                <div class="form-group">
                    <label for="tester-token"><strong>Token with Policy</strong></label>
                    <textarea id="tester-token" rows="4" placeholder="Paste a token created with Policy Builder"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="tester-action"><strong>Action</strong></label>
                    <input type="text" id="tester-action" placeholder="payments.send" value="payments.send">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="tester-resource-type"><strong>Resource Type</strong></label>
                        <input type="text" id="tester-resource-type" placeholder="merchant" value="merchant">
                    </div>
                    <div class="form-group">
                        <label for="tester-resource-id"><strong>Resource ID</strong></label>
                        <input type="text" id="tester-resource-id" placeholder="airbnb" value="">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="tester-amount"><strong>Amount</strong></label>
                        <input type="number" id="tester-amount" placeholder="250" value="">
                    </div>
                    <div class="form-group">
                        <label for="tester-currency"><strong>Currency</strong></label>
                        <input type="text" id="tester-currency" placeholder="USD" value="USD">
                    </div>
                </div>
                
                <button id="test-policy-btn" class="btn-primary">Test Policy</button>
                
                <div id="policy-test-output" class="output-section" style="display: none; margin-top: 1rem;">
                    <div id="policy-test-header" class="result-header"></div>
                    <div class="result-body">
                        <pre id="policy-test-result"></pre>
                    </div>
                </div>
            </section>

            <!-- Token Validator Tab -->
            <section class="tab-content input-section" data-content="validator">
                <h2 class="tab-title">Token Validator</h2>
                <p class="tab-description">Verify existing tokens and inspect their contents</p>
                
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                    <label for="token-input">
                        <strong>Paste Token (JWS Compact Format)</strong>
                    </label>
                    <select id="sample-tokens" class="sample-dropdown">
                        <option value="">-- Load Sample Token --</option>
                        <option value="valid">‚úÖ Valid Payment Token</option>
                        <option value="expired">‚ùå Expired Token</option>
                        <option value="limit">üí∞ High Limit Token</option>
                    </select>
                </div>
                <textarea 
                    id="token-input" 
                    placeholder="eyJhbGciOiJFZERTQSIsImtpZCI6ImtleS0xMjM0NTY3ODkwIiwidHlwIjoiSldUIn0..."
                    rows="6"
                ></textarea>

                <div class="options">
                    <label for="audience">
                        <strong>Expected Audience</strong> <span class="label-badge optional">Optional</span>
                    </label>
                    <input 
                        type="text" 
                        id="audience" 
                        placeholder="e.g., merchant.example, api.acme.com"
                    >
                    <small class="field-hint">Validates that the token was issued for this specific recipient. Leave empty to skip audience validation.</small>
                </div>
                
                <!-- Notification area -->
                <div id="notification-area" style="margin: 1rem 0;"></div>

                <button id="verify-btn" class="btn-primary">Verify Token</button>
                <button id="demo-btn" class="btn-secondary">Create Demo Token</button>
                <button id="revoke-btn" class="btn-warning">Revoke Token</button>
                
                <!-- Token Validator Output Section -->
                <section class="output-section" id="output" style="display: none;">
                    <div id="result-header" class="result-header"></div>
                    <div id="result-body" class="result-body"></div>
                </section>
            </section>

            <section class="info-section">
                <h2>About AgentOAuth</h2>
                <p>
                    AgentOAuth is a neutral protocol that lets AI agents prove who authorized what.
                    It uses JWS tokens with a five-field schema (user, agent, scope, limit, expiry + signature)
                    built on OAuth/JWT patterns.
                </p>
                <ul>
                    <li><strong>Spec:</strong> <a href="https://github.com/agentoauth/agentoauth" target="_blank">View Specification</a></li>
                    <li><strong>SDK:</strong> JavaScript/TypeScript (Python coming soon)</li>
                    <li><strong>License:</strong> MIT / Apache 2.0</li>
                </ul>
            </section>
        </main>
    </div>

    <script src="app.js"></script>
</body>
</html>

